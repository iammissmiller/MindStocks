<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Progress Tracker - MindStocks</title>

  <!-- Chart.js + DataLabels -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

  <style>
    :root {
      --bg-start: #eef2ff;
      --bg-end: #f9fafb;
      --card-bg1: rgba(255,255,255,0.9);
      --card-bg2: rgba(240,240,255,0.65);
      --text: #1f2937;
      --muted: #4b5563;
      --link: #4f46e5;
      --border: rgba(255,255,255,0.35);
      --shadow: 0 8px 24px rgba(0,0,0,0.08);
      --shadow-lg: 0 12px 32px rgba(0,0,0,0.12);
      --surface: #ffffff;
      --chip: #e5e7eb;
      --success: #16a34a;
      --warn: #f59e0b;
      --danger: #ef4444;
      --accent-1: #4f46e5;
      --accent-2: #6366f1;
      --accent-3: #3b82f6;
      --good: #10b981;
      --grid-gap: 24px;
    }
    html[data-theme="dark"] {
      --bg-start: #0b1020;
      --bg-end: #0f172a;
      --card-bg1: rgba(17,24,39,0.85);
      --card-bg2: rgba(30,41,59,0.55);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --link: #8b93ff;
      --border: rgba(255,255,255,0.08);
      --shadow: 0 8px 24px rgba(0,0,0,0.5);
      --shadow-lg: 0 12px 32px rgba(0,0,0,0.6);
      --surface: #0b1020;
      --chip: #1f2937;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
      color: var(--text);
    }
    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: white;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    header h1 { color: #4f46e5; font-size: 1.8rem; margin: 0; }
    nav a {
      text-decoration: none; color: #4b5563;
      padding: 8px 14px; border-radius: 8px;
      transition: background 0.3s; font-weight: 500;
    }
    nav a:hover { background: #e0e7ff; }
    nav a.active { background: #4f46e5; color: white; }
    .dropdown { position: relative; display: inline-block; }
    .dropdown-content {
      display: none; position: absolute; right: 0;
      background: white; min-width: 220px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.15);
      border-radius: 10px; overflow: hidden;
      animation: fadeIn 0.2s ease-in-out;
    }
    .dropdown:hover .dropdown-content { display: block; }
    .dropdown-content a {
      display: flex; align-items: center; gap: 10px;
      padding: 12px 16px; text-decoration: none;
      color: #374151; font-weight: 500;
      transition: background 0.2s;
    }
    .dropdown-content a:hover { background: #f3f4f6; color: #111827; }
    @keyframes fadeIn { from {opacity: 0; transform: translateY(-5px);} to {opacity: 1; transform: translateY(0);} }
    .main { padding: 36px 20px 60px; max-width: 1100px; margin: 0 auto; }
    .hero { display: grid; gap: 16px; margin-bottom: 26px; }
    .title { font-size: 2.1rem; margin: 0; }
    .subtitle { color: var(--muted); margin: 0; }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; align-items: center; }
    .btn, .select {
      background: var(--surface); color: var(--text);
      border: 1px solid var(--border); border-radius: 12px;
      padding: 8px 12px; font-weight: 600; cursor: pointer;
      transition: transform .15s ease, box-shadow .15s ease, background .2s ease;
      box-shadow: var(--shadow);
    }
    .btn:hover, .select:hover { transform: translateY(-1px); box-shadow: var(--shadow-lg); }
    .btn.primary { background: linear-gradient(135deg, var(--accent-1), var(--accent-3)); color: #fff; border: none; }
    .grid { display: grid; gap: var(--grid-gap); grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); margin-top: 22px; }
    .card {
      background: linear-gradient(145deg, var(--card-bg1), var(--card-bg2));
      border: 1px solid var(--border); border-radius: 18px; padding: 20px;
      box-shadow: var(--shadow); backdrop-filter: blur(12px);
      transition: transform .3s ease, box-shadow .3s ease, border-color .3s ease;
      position: relative; overflow: hidden;
      animation: fadeUp .5s ease both;
    }
    .card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .card h3 { margin: 0 0 10px; font-size: 1.05rem; }
    .stat { display: flex; align-items: baseline; gap: 6px; margin-top: 6px; }
    .stat .value { font-size: 2rem; font-weight: 800; }
    .stat .unit { color: var(--muted); font-weight: 600; }
    .chart-wrap { width: 100%; }
    canvas { max-width: 100%; height: 260px !important; }
    .badges { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 6px; }
    .badge {
      border: 1px solid var(--border); background: var(--surface);
      padding: 8px 10px; border-radius: 999px; font-weight: 700; font-size: .85rem;
      box-shadow: var(--shadow);
    }
    .badge.good { border-color: rgba(16,185,129,.35); }
    .badge.info { border-color: rgba(99,102,241,.35); }
    .badge.warn { border-color: rgba(245,158,11,.35); }
    footer { background: #111827; color: white; text-align: center; padding: 20px; font-size: .9rem; margin-top: 40px; }
    footer a { color: #93c5fd; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

<header>
  <h1><a href="index.html" style="text-decoration:none; color:#4f46e5;">MindStocks</a></h1>
  <nav>
    <a href="learning.html">Learning</a>
    <a href="quizhub.html">Quiz</a>
    <a href="tradingsimulator.html">Trading Simulation</a>
    <a href="progress.html" class="active">Progress Tracking</a>
    <div class="dropdown">
      <a href="#" class="dropbtn">Settings ‚ñæ</a>
      <div class="dropdown-content">
        <a href="#">üåê Switch Language</a>
        <a href="#" onclick="toggleTheme()">üåì Toggle Theme</a>
        <a href="#" onclick="resetProgress()">üîÑ Reset Progress</a>
      </div>
    </div>
  </nav>
</header>

<main class="main">
  <section class="hero">
    <h2 class="title">Your Learning Progress</h2>
    <p class="subtitle">A premium overview of your lessons, quizzes, and trading practice. Keep going ‚Äî consistency compounds.</p>
    <div class="controls">
      <select class="select" id="tradingRange">
        <option value="7">Last 7 days</option>
        <option value="30" selected>Last 30 days</option>
        <option value="all">All time</option>
      </select>
      <button class="btn" id="resetBtn">Reset Progress</button>
      <span class="chip" id="lastUpdated">Last updated ‚Äî just now</span>
    </div>
  </section>

  <!-- Top stats -->
  <section class="grid" id="topStats">
    <div class="card">
      <h3>üìö Lessons</h3>
      <div class="stat"><span class="value" id="lessonsCount">0</span><span class="unit">/ <span id="lessonsTotal">0</span></span></div>
      <div class="chart-wrap"><canvas id="lessonsChart"></canvas></div>
    </div>

    <div class="card">
      <h3>üìù Quizzes</h3>
      <div class="stat"><span class="value" id="quizzesCount">0</span><span class="unit">/ <span id="quizzesTotal">0</span></span></div>
      <div class="chart-wrap"><canvas id="quizzesChart"></canvas></div>
    </div>

    <div class="card">
      <h3>üìà Trading Practice</h3>
      <div class="stat">
        <span class="value" id="tradingCount">0</span><span class="unit"> attempts</span>
      </div>
      <div class="chart-wrap"><canvas id="tradingChart"></canvas></div>
    </div>
  </section>

  <section class="grid">
    <div class="card">
      <h3>üèÖ Milestones & Badges</h3>
      <div class="badges" id="badgesRow"></div>
    </div>
  </section>
</main>

<footer>
  ¬© 2025 MindStocks | Built for SEBI Hackathon |
  <a href="https://mail.google.com/mail/?view=cm&fs=1&to=sebi@sebi.gov.in" target="_blank" rel="noopener">Contact Us</a>
</footer>

<script>
  /***********************
   * Persistence & Theme *
   ***********************/
  const DEFAULT_PROGRESS = { lessons: 0, totalLessons: 8, quizzes: 0, totalQuizzes: 8, trading: 0, tradingHistory: [] };
  function getProgress() { return JSON.parse(localStorage.getItem("mindstocksProgress")) || DEFAULT_PROGRESS; }
  function saveProgress(p) { localStorage.setItem("mindstocksProgress", JSON.stringify(p)); document.getElementById("lastUpdated").textContent = "Last updated ‚Äî " + new Date().toLocaleString(); }
  function resetProgress() { if (confirm("Are you sure?")) { localStorage.setItem("mindstocksProgress", JSON.stringify(DEFAULT_PROGRESS)); location.reload(); } }
  function toggleTheme() { const current=document.documentElement.getAttribute("data-theme")||"light"; const next=current==="dark"?"light":"dark"; document.documentElement.setAttribute("data-theme", next); localStorage.setItem("mindstocksTheme", next); renderAll(); }

  const savedTheme = localStorage.getItem("mindstocksTheme") || "light"; document.documentElement.setAttribute("data-theme", savedTheme);

  /***********************
   * Helpers & Counters  *
   ***********************/
  function animateValue(el, start, end, duration=800) {
    if (start===end) { el.textContent=end; return; }
    const range=end-start, step=Math.max(1,Math.floor(duration/Math.abs(range)));
    let current=start, inc=end>start?1:-1;
    const timer=setInterval(()=>{ current+=inc; el.textContent=current; if(current===end) clearInterval(timer); },step);
  }
  function themeColors() {
    const s=getComputedStyle(document.documentElement);
    return { text:s.getPropertyValue('--text').trim()||'#1f2937', good:s.getPropertyValue('--good').trim()||'#10b981', accent1:s.getPropertyValue('--accent-1').trim()||'#4f46e5', chip:s.getPropertyValue('--chip').trim()||'#e5e7eb' };
  }

  /***********************
   * Chart.js Plugins    *
   ***********************/
  const CenterText = {
    id: "centerText",
    beforeDraw(chart, args, opts) {
      if (opts.text) {
        const { ctx } = chart;
        const c = themeColors();
        ctx.save();
        ctx.font = "600 16px Inter, sans-serif";
        ctx.fillStyle = c.text;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        const { top, left, width, height } = chart.chartArea;
        ctx.fillText(opts.text, left + width / 2, top + height / 2);
        ctx.restore();
      }
    }
  };
  Chart.register(ChartDataLabels, CenterText);

  let charts = { lessons:null, quizzes:null , trading:null};

  function renderCharts() {
  const p=getProgress(), c=themeColors();
  const doughnutOptions=(text)=>({
    cutout:"70%",
    plugins:{
      legend:{display:false},
      datalabels:{ color:c.text, formatter:(v)=>v>0?v:"", font:{weight:600}},
      centerText:{ text }
    }
  });

  // Lessons
if(charts.lessons) charts.lessons.destroy();
charts.lessons = new Chart(document.getElementById("lessonsChart"), {
  type: "doughnut",
  data: {
    labels: ["Completed", "Pending"],
    datasets: [{
      data: [p.lessons, p.totalLessons - p.lessons],
      backgroundColor: [
        "linear-gradient(135deg, #16a34a, #22c55e)", // green gradient
        "#e5e7eb" // pending gray
      ].map(color => {
        // Create gradient if needed
        const ctx = document.getElementById("lessonsChart").getContext("2d");
        if (color.startsWith("linear-gradient")) {
          const gradient = ctx.createLinearGradient(0, 0, 0, 200);
          gradient.addColorStop(0, "#16a34a");
          gradient.addColorStop(1, "#22c55e");
          return gradient;
        }
        return color;
      }),
      borderWidth: 0,
      borderRadius: 6,   // rounded edges
      hoverOffset: 8     // lifts slice slightly on hover
    }]
  },
  options: {
    cutout: "70%",
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: function(context) {
            const total = context.dataset.data.reduce((a,b)=>a+b,0);
            const value = context.raw;
            const percent = ((value/total)*100).toFixed(1);
            return `${context.label}: ${value} (${percent}%)`;
          }
        }
      },
      datalabels: {
        color: "#111827",
        font: { weight: 700 },
        formatter: (v) => v > 0 ? v : ""
      },
      centerText: { text: `${p.lessons}/${p.totalLessons}` }
    }
  }
});

// Quizzes (same pattern but blue shades)
if(charts.quizzes) charts.quizzes.destroy();
charts.quizzes = new Chart(document.getElementById("quizzesChart"), {
  type: "doughnut",
  data: {
    labels: ["Completed", "Pending"],
    datasets: [{
      data: [p.quizzes, p.totalQuizzes - p.quizzes],
      backgroundColor: [
        "linear-gradient(135deg, #3b82f6, #60a5fa)", // blue gradient
        "#e5e7eb"
      ].map(color => {
        const ctx = document.getElementById("quizzesChart").getContext("2d");
        if (color.startsWith("linear-gradient")) {
          const gradient = ctx.createLinearGradient(0, 0, 0, 200);
          gradient.addColorStop(0, "#3b82f6");
          gradient.addColorStop(1, "#60a5fa");
          return gradient;
        }
        return color;
      }),
      borderWidth: 0,
      borderRadius: 6,
      hoverOffset: 8
    }]
  },
  options: {
    cutout: "70%",
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: function(context) {
            const total = context.dataset.data.reduce((a,b)=>a+b,0);
            const value = context.raw;
            const percent = ((value/total)*100).toFixed(1);
            return `${context.label}: ${value} (${percent}%)`;
          }
        }
      },
      datalabels: {
        color: "#111827",
        font: { weight: 700 },
        formatter: (v) => v > 0 ? v : ""
      },
      centerText: { text: `${p.quizzes}/${p.totalQuizzes}` }
    }
  }
});


  // Trading chart
  // Trading chart
if(charts.trading) charts.trading.destroy();
const tradingCanvas = document.getElementById("tradingChart");
if(p.tradingHistory && p.tradingHistory.length){
  charts.trading = new Chart(tradingCanvas, {
    type: "line",
    data: {
      labels: p.tradingHistory.map(h => new Date(h.t).toLocaleTimeString()),
      datasets: [{
        label: "Portfolio Value",
        data: p.tradingHistory.map(h => h.v),
        borderColor: c.accent1,
        backgroundColor: c.accent2,
        fill: false,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: c.text } },
        y: { ticks: { color: c.text } }
      }
    }
  });
} else {
  const ctx = tradingCanvas.getContext("2d");
  ctx.clearRect(0,0,tradingCanvas.width,tradingCanvas.height);
  ctx.fillStyle = c.muted;
  ctx.font = "14px Inter, sans-serif";
  ctx.textAlign = "center";
  ctx.fillText("No trading history yet.", tradingCanvas.width/2, tradingCanvas.height/2);
}

}

  /***********************
   * Badges              *
   ***********************/
  function computeBadges(p) {
    const b=[]; if(p.lessons>=1) b.push({t:"First Lesson",c:"info"});
    if(p.lessons===p.totalLessons&&p.totalLessons>0) b.push({t:"All Lessons Complete",c:"good"});
    if(p.quizzes>=1) b.push({t:"Quiz Explorer",c:"info"});
    if(p.quizzes>=Math.ceil(p.totalQuizzes/2)) b.push({t:"Halfway on Quizzes",c:"info"});
    if(p.quizzes===p.totalQuizzes&&p.totalQuizzes>0) b.push({t:"Quiz Champion",c:"good"});
    if(p.trading>=1) b.push({t:"First Trade Sim",c:"info"});
    return b;
  }
  function renderBadges(p) {
    const row=document.getElementById("badgesRow"); row.innerHTML=""; const b=computeBadges(p);
    if(!b.length) { row.innerHTML=`<span class="badge">No badges yet ‚Äî start learning!</span>`; return; }
    b.forEach(x=>{ const el=document.createElement("span"); el.className=`badge ${x.c}`; el.textContent=x.t; row.appendChild(el); });
  }

  /***********************
   * Render & Wiring     *
   ***********************/
  function renderAll() {
    const p=getProgress();
    animateValue(document.getElementById("lessonsCount"), Number(document.getElementById("lessonsCount").textContent||0), p.lessons);
    animateValue(document.getElementById("quizzesCount"), Number(document.getElementById("quizzesCount").textContent||0), p.quizzes);
    animateValue(document.getElementById("tradingCount"), Number(document.getElementById("tradingCount").textContent||0), p.trading);
    document.getElementById("lessonsTotal").textContent=p.totalLessons;
    document.getElementById("quizzesTotal").textContent=p.totalQuizzes;
    renderBadges(p); renderCharts();
  }

  document.getElementById("resetBtn").addEventListener("click", resetProgress);

  // init
  renderAll();
</script>
</body>
</html>
